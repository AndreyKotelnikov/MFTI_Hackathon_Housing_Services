# üìä –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ú–ö–î –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –º–Ω–æ–≥–æ–∫–≤–∞—Ä—Ç–∏—Ä–Ω—ã–º–∏ –¥–æ–º–∞–º–∏ (–ú–ö–î). –ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω—ã–π pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, feature engineering –∏ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –æ—Ç—Ç–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞](#–æ–ø–∏—Å–∞–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–¥–∞–Ω–Ω—ã—Ö)
- [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ-–±–ª–æ–∫–∏)
- [–ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞](#–∑–∞–ø—É—Å–∫-–∞–Ω–∞–ª–∏–∑–∞)
- [–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞](#—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã-–∞–Ω–∞–ª–∏–∑–∞)
- [–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–º–µ—Ç—Ä–∏–∫–∏)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É **–∞–Ω–∞–ª–∏–∑–∞ –æ—Ç—Ç–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (churn analysis) –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ú–ö–î, —Å—Ä–∞–≤–Ω–∏–≤–∞—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- **Lost users** (is_lost=True) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∞–∫—Ç–∏–≤–Ω—ã–µ –≤ —Å–µ–Ω—Ç—è–±—Ä–µ, –Ω–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –≤ –æ–∫—Ç—è–±—Ä–µ
- **Stay users** (is_stay=True) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∞–∫—Ç–∏–≤–Ω—ã–µ –≤ –æ–±–æ–∏—Ö –º–µ—Å—è—Ü–∞—Ö
- **New users** (is_new=True) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤ –æ–∫—Ç—è–±—Ä–µ

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö**: 1.8M+ —Å–æ–±—ã—Ç–∏–π, 400K+ —Å–µ—Å—Å–∏–π  
‚úÖ **17 —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤**: –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ –¥–æ –≥–æ—Ä–æ–¥—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤  
‚úÖ **136 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**: –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –±–ª–æ–∫—É  
‚úÖ **–í–æ—Ä–æ–Ω–∫–∏ –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏**: –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—É—Ç–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
‚úÖ **7 –º–æ–¥—É–ª–µ–π –∞–Ω–∞–ª–∏–∑–∞**: –æ—Ç –±–∞–∑–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–æ ML-—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: –≥—Ä–∞—Ñ–∏–∫–∏, heatmap, –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏  

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project/
‚îÇ
‚îú‚îÄ‚îÄ config.yaml                          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ main.py                              # –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ requirements.txt                     # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ
‚îú‚îÄ‚îÄ data/                                # –î–∞–Ω–Ω—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ raw/                            # –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ events.csv                  # –°–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.csv                   # –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ processed/                      # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ       ‚îî‚îÄ‚îÄ merged_data.csv             # –ò—Ç–æ–≥–æ–≤—ã–π –¥–∞—Ç–∞—Å–µ—Ç
‚îÇ
‚îú‚îÄ‚îÄ src/                                 # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ data_preprocessing.py           # –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ utils.py                        # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ fb2/                            # –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ v2
‚îÇ       ‚îú‚îÄ‚îÄ categorize_combinations.py  # –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ export_to_text.py          # –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ç–µ–∫—Å—Ç
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ funnels/                    # –í–æ—Ä–æ–Ω–∫–∏
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ funnel_features_extractor.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ apply_funnel_features.py
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ path_analyze/               # –ê–Ω–∞–ª–∏–∑ –ø—É—Ç–µ–π
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ path_analyzer.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ build_funnels_v5.py
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ README_path_analyzer.md
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ full_analyze/               # –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
‚îÇ           ‚îú‚îÄ‚îÄ analyze_user_behavior.py
‚îÇ           ‚îú‚îÄ‚îÄ ANALYSIS_SYSTEM_SUMMARY.md
‚îÇ           ‚îî‚îÄ‚îÄ analysis_modules/
‚îÇ               ‚îú‚îÄ‚îÄ basic_statistics.py
‚îÇ               ‚îú‚îÄ‚îÄ block_analysis.py
‚îÇ               ‚îú‚îÄ‚îÄ temporal_analysis.py
‚îÇ               ‚îú‚îÄ‚îÄ efficiency_analysis.py
‚îÇ               ‚îú‚îÄ‚îÄ segmentation.py
‚îÇ               ‚îú‚îÄ‚îÄ pattern_mining.py
‚îÇ               ‚îî‚îÄ‚îÄ visualization.py
‚îÇ
‚îú‚îÄ‚îÄ reports/                            # –û—Ç—á—ë—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ json/                          # JSON –æ—Ç—á—ë—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ html/                          # HTML –ø—Ä–æ—Ñ–∏–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ figures/                       # –ì—Ä–∞—Ñ–∏–∫–∏
‚îÇ
‚îî‚îÄ‚îÄ fb2_output/                        # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
    ‚îî‚îÄ‚îÄ analysis_results/
        ‚îú‚îÄ‚îÄ 01_statistics/
        ‚îú‚îÄ‚îÄ 02_block_analysis/
        ‚îú‚îÄ‚îÄ 03_temporal_analysis/
        ‚îú‚îÄ‚îÄ 04_efficiency_analysis/
        ‚îú‚îÄ‚îÄ 05_segmentation/
        ‚îú‚îÄ‚îÄ 06_patterns/
        ‚îú‚îÄ‚îÄ 07_visualizations/
        ‚îî‚îÄ‚îÄ 08_final_reports/
```

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- 8GB+ RAM (–¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤)
- 5GB+ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config.yaml`:

```yaml
data:
  raw_path: "data/raw"
  processed_path: "data/processed"
  events_file: "events.csv"
  users_file: "users.csv"

reports:
  json_path: "reports/json"
  html_path: "reports/html"
  figures_path: "reports/figures"
```

---

## üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ–ª–Ω—ã–π pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å—ã—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–æ –≥–æ—Ç–æ–≤–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏.

### –≠—Ç–∞–ø 1: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–§–∞–π–ª `events.csv`** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏):
- `–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è` - timestamp —Å–æ–±—ã—Ç–∏—è
- `–≠–∫—Ä–∞–Ω` - –Ω–∞–∑–≤–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
- `–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª` - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- `–î–µ–π—Å—Ç–≤–∏–µ` - –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
- `–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞` - ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `–ù–æ–º–µ—Ä —Å–µ—Å—Å–∏–∏ –≤ —Ä–∞–º–∫–∞—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞` - ID —Å–µ—Å—Å–∏–∏
- `–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞`, `–ú–æ–¥–µ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞`, `–¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞`, `–û–°`

**–§–∞–π–ª `users.csv`** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏):
- `number` - ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–¥–ª—è join)
- `age_back` - –≤–æ–∑—Ä–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `gender` - –ø–æ–ª

### –≠—Ç–∞–ø 2: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ merge

```python
from src.data_preprocessing import DataPreprocessor

preprocessor = DataPreprocessor("config.yaml")

# –ó–∞–≥—Ä—É–∑–∫–∞ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø–∞–º—è—Ç–∏
events_df, users_df = preprocessor.load_data()

# –û—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤
preprocessor.clean_data()

# –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏ join
merged_df = preprocessor.create_features()
```

**–ß—Ç–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
- `date`, `hour`, `day_of_week`, `is_weekend`, `month`, `day`
- `time_of_day` (–£—Ç—Ä–æ/–î–µ–Ω—å/–í–µ—á–µ—Ä/–ù–æ—á—å)
- `age_group` (18-24, 25-34, 35-44, 45-54, 55-64, 65+)

### –≠—Ç–∞–ø 3: Pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Å—Å–∏–π

#### 3.1 –ì–ª–æ–±–∞–ª—å–Ω—ã–π ID —Å–µ—Å—Å–∏–∏

```python
# –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –¥–ª—è –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏
preprocessor.add_global_session_id()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ö–æ–ª–æ–Ω–∫–∞ `global_session_id` - —Å–∫–≤–æ–∑–Ω–æ–π ID (1, 2, 3, ...)
- –î–∞–Ω–Ω—ã–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ session_id + –≤—Ä–µ–º—è

#### 3.2 –†–∞—Å—á—ë—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏–π

```python
# –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å = –≤—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è
preprocessor.calculate_event_duration()
```

**–õ–æ–≥–∏–∫–∞:**
```
| –í—Ä–µ–º—è     | duration_seconds | –û–ø–∏—Å–∞–Ω–∏–µ                    |
|-----------|------------------|-----------------------------|
| 10:00:00  | 5               | 5 —Å–µ–∫ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è |
| 10:00:05  | 7               | 7 —Å–µ–∫ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ         |
| 10:00:12  | 0               | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤ —Å–µ—Å—Å–∏–∏          |
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ö–æ–ª–æ–Ω–∫–∞ `duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

#### 3.3 –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

```python
# –°—Ö–ª–æ–ø—ã–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –¥–µ–π—Å—Ç–≤–∏–π —Å –ø–æ–¥—Å—á—ë—Ç–æ–º –∫–ª–∏–∫–æ–≤
preprocessor.remove_consecutive_duplicates_with_clicks()
```

**–õ–æ–≥–∏–∫–∞:**

**–ë—ã–ª–æ (4 –∑–∞–ø–∏—Å–∏):**
```
| –≠–∫—Ä–∞–Ω | –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª       | –î–µ–π—Å—Ç–≤–∏–µ         | duration | click_count |
|-------|------------------|------------------|----------|-------------|
| –ï—â–µ   | –û—Ç–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞  | –ù–µ —É–∫–∞–∑–∞–Ω–æ       | 3        | 0           |
| –ï—â–µ   | –û—Ç–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞  | –ù–µ —É–∫–∞–∑–∞–Ω–æ       | 2        | 0           |
| –ï—â–µ   | –û—Ç–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞  | –¢–∞–ø –Ω–∞ –∫–Ω–æ–ø–∫—É    | 5        | 0           |
| –ï—â–µ   | –û—Ç–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞  | –¢–∞–ø –Ω–∞ –∫–Ω–æ–ø–∫—É    | 5        | 0           |
```

**–°—Ç–∞–ª–æ (1 –∑–∞–ø–∏—Å—å):**
```
| –≠–∫—Ä–∞–Ω | –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª       | –î–µ–π—Å—Ç–≤–∏–µ         | duration | click_count | dbl_duration | dbl_count |
|-------|------------------|------------------|----------|-------------|--------------|-----------|
| –ï—â–µ   | –û—Ç–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞  | –¢–∞–ø –Ω–∞ –∫–Ω–æ–ø–∫—É    | 15       | 2           | 10           | 3         |
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `click_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤ (–≥–¥–µ –î–µ–π—Å—Ç–≤–∏–µ != "–ù–µ —É–∫–∞–∑–∞–Ω–æ")
- `dbl_duration_seconds` - —Å—É–º–º–∞—Ä–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –¥—É–±–ª–µ–π
- `dbl_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –¥—É–±–ª–µ–π

#### 3.4 –°—Ö–ª–æ–ø—ã–≤–∞–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤

```python
# –£–¥–∞–ª–µ–Ω–∏–µ "–ù–µ —É–∫–∞–∑–∞–Ω–æ" –Ω–∞ –æ–¥–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
preprocessor.collapse_intermediate_screens()
```

**–õ–æ–≥–∏–∫–∞:**

**–ë—ã–ª–æ:**
```
| –≠–∫—Ä–∞–Ω        | –î–µ–π—Å—Ç–≤–∏–µ         | duration |
|--------------|------------------|----------|
| –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ | –ù–µ —É–∫–∞–∑–∞–Ω–æ       | 5        |
| –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ | –ù–µ —É–∫–∞–∑–∞–Ω–æ       | 3        |
| –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ | –¢–∞–ø –Ω–∞ –∫–Ω–æ–ø–∫—É    | 10       |
```

**–°—Ç–∞–ª–æ:**
```
| –≠–∫—Ä–∞–Ω        | –î–µ–π—Å—Ç–≤–∏–µ         | duration |
|--------------|------------------|----------|
| –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ | –¢–∞–ø –Ω–∞ –∫–Ω–æ–ø–∫—É    | 18       |
```

#### 3.5 –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–≤—ã—Ö –ø—É—Å—Ç—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤

```python
# –£–¥–∞–ª–µ–Ω–∏–µ "–ï—â–µ ‚Üí –û—Ç–∫—Ä—ã—Ç–∏–µ ‚Üí –ù–µ —É–∫–∞–∑–∞–Ω–æ" –≤ –∫–æ–Ω—Ü–µ —Å–µ—Å—Å–∏–π
preprocessor.remove_trailing_empty_screens()
```

**–£–¥–∞–ª—è–µ—Ç—Å—è:** –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Å–µ—Å—Å–∏–∏ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º:
- –≠–∫—Ä–∞–Ω = "–ï—â–µ"
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª = "–û—Ç–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞"  
- –î–µ–π—Å—Ç–≤–∏–µ = "–ù–µ —É–∫–∞–∑–∞–Ω–æ"

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª –º–µ–Ω—é –∏ –≤—ã—à–µ–ª –±–µ–∑ –¥–µ–π—Å—Ç–≤–∏–π.

#### 3.6 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—á–∞—Ç–æ–∫

```python
# –ê–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –æ–ø–µ—á–∞—Ç–æ–∫
preprocessor.fix_action_functional_typos()
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- "–≤—ã–±–æ—Ä —Ç–µ–≥–∞ 1" ‚Üí "–í—ã–±–æ—Ä —Ç–µ–≥–∞ 1"
- "–¢–∞–ø –Ω–∞ —É—Å–ª—É–≥—É –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤" ‚Üí "–¢–∞–ø –Ω–∞ —É—Å–ª—É–≥—É –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤"

### –≠—Ç–∞–ø 4: –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –±–ª–æ–∫–∞–º

#### 4.1 –≠–∫—Å–ø–æ—Ä—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π

```python
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
preprocessor.save_unique_combinations_json()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `unique_combinations.json`
- –í—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏: –≠–∫—Ä–∞–Ω => –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª => –î–µ–π—Å—Ç–≤–∏–µ
- –° —á–∞—Å—Ç–æ—Ç–∞–º–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏

#### 4.2 –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ 17 –±–ª–æ–∫–æ–≤

```bash
python src/fb2/categorize_combinations.py
```

**–í—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª:** `unique_combinations.json`  
**–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª:** `categorized_combinations.json`

**17 —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤:**

| ‚Ññ  | –ë–ª–æ–∫                                | –ü—Ä–µ—Ñ–∏–∫—Å      |
|----|-------------------------------------|--------------|
| 1  | –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏                     | `request`    |
| 2  | –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏      | `req_manage` |
| 3  | –ü—Ä–æ—Ñ–∏–ª—å                             | `profile`    |
| 4  | –ù–∞–≤–∏–≥–∞—Ü–∏—è                           | `nav`        |
| 5  | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è                         | `notif`      |
| 6  | –û–ø—Ä–æ—Å—ã –∏ —Å–æ–±—Ä–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤     | `poll_oss`   |
| 7  | –ë–∞–ª–ª—ã –∏ –ø–æ–æ—â—Ä–µ–Ω–∏—è                   | `rewards`    |
| 8  | –ú–æ–π –¥–æ–º                             | `my_home`    |
| 9  | –£—Å–ª—É–≥–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤                    | `partners`   |
| 10 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º              | `transport`  |
| 11 | –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏–π                 | `ann_view`   |
| 12 | –£–º–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è                       | `smart`      |
| 13 | –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞                        | `support`    |
| 14 | –ì–æ—Å—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø                     | `guest`      |
| 15 | –ì–æ—Ä–æ–¥—Å–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã                   | `city_serv`  |
| 16 | –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞                     | `address`    |
| 17 | –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è                 | `ann_create` |

#### 4.3 –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤–æ—Ä–æ–Ω–æ–∫

```bash
python src/fb2/path_analyze/build_funnels_v5.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–ø-–ø—É—Ç–∏ –∫ —Ü–µ–ª–µ–≤—ã–º –¥–µ–π—Å—Ç–≤–∏—è–º
- –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –∫–∞–∂–¥–æ–º—É –¥–µ–π—Å—Ç–≤–∏—é `step` –∏ `version`
- –°–æ–∑–¥–∞—ë—Ç `categorized_combinations_with_funnels.json`

### –≠—Ç–∞–ø 5: Feature Engineering –ø–æ –±–ª–æ–∫–∞–º

```python
from src.fb2.funnels.funnel_features_extractor import FunnelFeaturesExtractor

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
extractor = FunnelFeaturesExtractor('categorized_combinations_with_funnels.json')

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –¥–∞—Ç–∞—Å–µ—Ç—É
df_transformed = extractor.transform(merged_df)
```

**–°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (136 —à—Ç—É–∫):**

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 17 –±–ª–æ–∫–æ–≤:

| –ö–æ–ª–æ–Ω–∫–∞              | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
|----------------------|-------------------------------------------|
| `{prefix}_count`     | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π –≤ –±–ª–æ–∫–µ         |
| `{prefix}_max_step`  | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —à–∞–≥ –≤ –≤–æ—Ä–æ–Ω–∫–µ (-1 –µ—Å–ª–∏ –Ω–µ—Ç)  |
| `{prefix}_success_count` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π         |
| `{prefix}_review_count`  | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ review –¥–µ–π—Å—Ç–≤–∏–π           |
| `{prefix}_dur_sec`   | –°—É–º–º–∞—Ä–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫)              |
| `{prefix}_click_count` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤                       |
| `{prefix}_dbl_dur_sec` | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥—É–±–ª–µ–π (—Å–µ–∫)              |
| `{prefix}_dbl_count` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—É–±–ª–µ–π                         |

**–ü—Ä–∏–º–µ—Ä –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –±–ª–æ–∫–∞ "–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏" (request):**
- `request_count`
- `request_max_step`
- `request_success_count`
- `request_review_count`
- `request_dur_sec`
- `request_click_count`
- `request_dbl_dur_sec`
- `request_dbl_count`

### –≠—Ç–∞–ø 6: –°—Ö–ª–æ–ø—ã–≤–∞–Ω–∏–µ –¥–æ —É—Ä–æ–≤–Ω—è —Å–µ—Å—Å–∏–π

**–í–ê–ñ–ù–û:** `FunnelFeaturesExtractor.transform()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. **–ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–æ —Å–µ—Å—Å–∏—è–º:**
   - –°—É–º–º–∏—Ä—É–µ—Ç count, duration, clicks
   - –ù–∞—Ö–æ–¥–∏—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π step
   - –°—á–∏—Ç–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

2. **–°–æ–∑–¥–∞—ë—Ç –∫–æ–ª–æ–Ω–∫—É `sess_dur_sec`:**
   - –°—É–º–º–∞ –≤—Å–µ—Ö `duration_seconds` –≤ —Å–µ—Å—Å–∏–∏
   - –ü–æ–ª–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏

3. **–û—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏:**
   - –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã –¥–ª—è —Å—Ç—Ä–æ–∫ –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏
   - –î–∞—Ç–∞—Å–µ—Ç —Å–æ–∫—Ä–∞—â–∞–µ—Ç—Å—è –≤ ~4-5 —Ä–∞–∑

**–ë—ã–ª–æ:** 1,822,985 —Å—Ç—Ä–æ–∫ (—Å–æ–±—ã—Ç–∏—è)  
**–°—Ç–∞–ª–æ:** ~400,000 —Å—Ç—Ä–æ–∫ (—Å–µ—Å—Å–∏–∏)

### –≠—Ç–∞–ø 7: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–≥–æ—Ä—Ç–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤

```python
# –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∫–æ–≥–æ—Ä—Ç–∞–º
df_final = preprocessor.add_user_cohort_status(df_transformed)
```

**–°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏:**

| –ö–æ–ª–æ–Ω–∫–∞   | –û–ø–∏—Å–∞–Ω–∏–µ                                           |
|-----------|----------------------------------------------------|
| `is_lost` | –ê–∫—Ç–∏–≤–µ–Ω –≤ —Å–µ–Ω—Ç—è–±—Ä–µ, –ù–ï –∞–∫—Ç–∏–≤–µ–Ω –≤ –æ–∫—Ç—è–±—Ä–µ (–æ—Ç—Ç–æ–∫)   |
| `is_stay` | –ê–∫—Ç–∏–≤–µ–Ω –ò –≤ —Å–µ–Ω—Ç—è–±—Ä–µ, –ò –≤ –æ–∫—Ç—è–±—Ä–µ (—É–¥–µ—Ä–∂–∞–Ω–∏–µ)      |
| `is_new`  | –ê–∫—Ç–∏–≤–µ–Ω –¢–û–õ–¨–ö–û –≤ –æ–∫—Ç—è–±—Ä–µ (–Ω–æ–≤—ã–µ)                   |

**–õ–æ–≥–∏–∫–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –°—Ç–∞—Ç—É—Å    ‚îÇ –°–µ–Ω—Ç—è–±—Ä—å‚îÇ –û–∫—Ç—è–±—Ä—å‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ is_lost     ‚îÇ    ‚úì    ‚îÇ   ‚úó    ‚îÇ
‚îÇ is_stay     ‚îÇ    ‚úì    ‚îÇ   ‚úì    ‚îÇ
‚îÇ is_new      ‚îÇ    ‚úó    ‚îÇ   ‚úì    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –≠—Ç–∞–ø 8: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

```python
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞
preprocessor.save_processed_data()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `data/processed/merged_data.csv`

**–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- –ë–∞–∑–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (15): –≤—Ä–µ–º—è, —ç–∫—Ä–∞–Ω, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –¥–µ–π—Å—Ç–≤–∏–µ, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (7): date, hour, day_of_week, time_of_day, etc.
- –ú–µ—Ç—Ä–∏–∫–∏ —Å–µ—Å—Å–∏–∏ (5): global_session_id, sess_dur_sec, duration_seconds, click_count, dbl_*
- –ë–ª–æ–∫–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (136): 17 –±–ª–æ–∫–æ–≤ √ó 8 –º–µ—Ç—Ä–∏–∫
- –ö–æ–≥–æ—Ä—Ç–Ω—ã–µ —Ñ–ª–∞–≥–∏ (3): is_lost, is_stay, is_new

**–í–°–ï–ì–û: ~166 –∫–æ–ª–æ–Ω–æ–∫**

---

## üî¨ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏

### –ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–ª–æ–∫?

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–ª–æ–∫ - —ç—Ç–æ –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã—Ö –æ–±—â–µ–π —Ü–µ–ª—å—é.

### –ü—Ä–∏–º–µ—Ä—ã –±–ª–æ–∫–æ–≤

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ (request)

**–¢–∏–ø–∏—á–Ω—ã–π –ø—É—Ç—å:**
```
–ï—â–µ ‚Üí –ó–∞—è–≤–∫–∏ ‚Üí –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ ‚Üí –í—ã–±–æ—Ä —Ç–µ–º—ã ‚Üí –û–ø–∏—Å–∞–Ω–∏–µ ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞
```

**–ú–µ—Ç—Ä–∏–∫–∏:**
- `request_count` = 5 (–¥–µ–π—Å—Ç–≤–∏–π –≤ –±–ª–æ–∫–µ)
- `request_max_step` = 5 (–¥–æ—à—ë–ª –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏)
- `request_success_count` = 1 (–æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞—è–≤–∫—É)
- `request_dur_sec` = 180 (–ø—Ä–æ–≤—ë–ª 3 –º–∏–Ω—É—Ç—ã)

#### 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫ (req_manage)

**–¢–∏–ø–∏—á–Ω—ã–π –ø—É—Ç—å:**
```
–ó–∞—è–≤–∫–∏ ‚Üí –°–ø–∏—Å–æ–∫ ‚Üí –í—ã–±–æ—Ä –∑–∞—è–≤–∫–∏ ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π
```

#### 3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (notif)

**–¢–∏–ø–∏—á–Ω—ã–π –ø—É—Ç—å:**
```
–í–∞–∂–Ω–æ–µ ‚Üí –¢–∞–ø –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä
```

### –í–æ—Ä–æ–Ω–∫–∏ (Funnels)

–ö–∞–∂–¥—ã–π –±–ª–æ–∫ –∏–º–µ–µ—Ç –≤–æ—Ä–æ–Ω–∫—É - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤ –∫ —Ü–µ–ª–µ–≤–æ–º—É –¥–µ–π—Å—Ç–≤–∏—é.

**–ü—Ä–∏–º–µ—Ä –≤–æ—Ä–æ–Ω–∫–∏ "–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏":**

```
Step 1 (version 1): –ï—â–µ ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª '–ó–∞—è–≤–∫–∏'
Step 2 (version 1): –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ ‚Üí –û—Ç–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞
Step 3 (version 1): –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ ‚Üí –í—ã–±–æ—Ä —Ç–µ–º—ã
Step 3 (version 2): –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ ‚Üí –í—ã–±–æ—Ä —á–µ—Ä–µ–∑ —Ç–µ–≥–∏  ‚Üê –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø—É—Ç—å
Step 4 (version 1): –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ ‚Üí –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
Step 0 (version 0): –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏    ‚Üê —Ü–µ–ª–µ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- `step` - –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—É—Ç–∏
- `version` - –≤–∞—Ä–∏–∞–Ω—Ç –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –¥–∞–Ω–Ω–æ–º —à–∞–≥–µ
- `step=0` - —Ü–µ–ª–µ–≤–æ–µ —É—Å–ø–µ—à–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
- `version=0` - –æ—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è

---

## üöÄ –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```python
python main.py
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ó–∞–≥—Ä—É–∑–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `data/processed/merged_data.csv`
2. –ü—Ä–∏–º–µ–Ω–∏—Ç funnel features (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
3. –ó–∞–ø—É—Å—Ç–∏—Ç –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `fb2_output/`

### –ü–æ—à–∞–≥–æ–≤—ã–π –∑–∞–ø—É—Å–∫

#### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)

```python
from src.data_preprocessing import DataPreprocessor

preprocessor = DataPreprocessor("config.yaml")
preprocessor.load_data()
preprocessor.clean_data()
merged_df = preprocessor.create_features()

# Pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏
preprocessor.add_global_session_id()
preprocessor.calculate_event_duration()
preprocessor.remove_consecutive_duplicates_with_clicks()
preprocessor.collapse_intermediate_screens()
preprocessor.remove_trailing_empty_screens()
preprocessor.fix_action_functional_typos()

preprocessor.save_processed_data()
```

#### –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```python
preprocessor = DataPreprocessor("config.yaml")
df = preprocessor.load_merged_data()
```

#### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ funnel features

```python
from src.fb2.funnels.funnel_features_extractor import FunnelFeaturesExtractor

json_path = 'src/fb2/funnels/categorized_combinations_with_funnels.json'
extractor = FunnelFeaturesExtractor(json_path)

df_transformed = extractor.transform(df)
```

#### –®–∞–≥ 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–≥–æ—Ä—Ç

```python
df_final = preprocessor.add_user_cohort_status(df_transformed)
```

#### –®–∞–≥ 5: –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞

```python
from src.fb2.full_analyze.analyze_user_behavior import UserBehaviorAnalyzer

analyzer = UserBehaviorAnalyzer("", 'fb2_output')
analyzer.run_full_analysis(df_final)
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞

–ê–Ω–∞–ª–∏–∑ —Å–æ–∑–¥–∞—ë—Ç 8 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –æ—Ç—á—ë—Ç–æ–≤:

### 1. –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (01_statistics/)

**–§–∞–π–ª—ã:**
- `01_overall_statistics.txt` - –æ–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –≥—Ä—É–ø–ø–∞–º
- `02_demographic_analysis.txt` - –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—è (–ø–æ–ª, –≤–æ–∑—Ä–∞—Å—Ç)
- `03_device_analysis.txt` - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –û–°
- `04_session_duration_analysis.txt` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π
- `05_block_usage_comparison.txt` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤
- `06_statistical_tests.txt` - —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
```
Churn Rate: 35.2%
Retention Rate: 64.8%

–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏:
  Lost: 245 —Å–µ–∫
  Stay: 198 —Å–µ–∫
  –†–∞–∑–Ω–∏—Ü–∞: -47 —Å–µ–∫  ‚Üê Lost –ø—Ä–æ–≤–æ–¥—è—Ç –ë–û–õ–¨–®–ï –≤—Ä–µ–º–µ–Ω–∏!
```

### 2. –ê–Ω–∞–ª–∏–∑ –ø–æ –±–ª–æ–∫–∞–º (02_block_analysis/)

**17 –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤** - –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π –±–ª–æ–∫.

**–ü—Ä–∏–º–µ—Ä (block_request.txt):**
```
–ê–ù–ê–õ–ò–ó –ë–õ–û–ö–ê: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ (request)

COUNT:
–ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
  Lost: 15.2%
  Stay: 18.5%
  –†–∞–∑–Ω–∏—Ü–∞: +3.3%

–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
  Lost: 0.25
  Stay: 0.31
  –†–∞–∑–Ω–∏—Ü–∞: +0.06

MAX_STEP:
–ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
  Lost: 12.1%
  Stay: 16.3%
  –†–∞–∑–Ω–∏—Ü–∞: +4.2%  ‚Üê Stay –≥–ª—É–±–∂–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç
```

**–°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:** `all_blocks_comparison.csv`

### 3. –í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑ (03_temporal_analysis/)

**–§–∞–π–ª—ã:**
- `hourly_distribution.txt` - –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º
- `weekly_patterns.txt` - –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏

**–ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Å–∞–π—Ç–æ–≤:**
```
–ü–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ Lost: 18:00-20:00 (–≤–µ—á–µ—Ä)
–ü–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ Stay: 12:00-14:00 (–æ–±–µ–¥)

–í—ã—Ö–æ–¥–Ω—ã–µ:
  Lost: 25% –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  Stay: 30% –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
```

### 4. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (04_efficiency_analysis/)

**–ú–µ—Ç—Ä–∏–∫–∏:**
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–æ–ª–µ–∑–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∫ –¥—É–±–ª—è–º
- –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–æ–Ω—ã —Å –≤—ã—Å–æ–∫–∏–º click_count
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞

```
request: Lost=85%, Stay=92%
nav:     Lost=70%, Stay=88%  ‚Üê –±–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞
notif:   Lost=95%, Stay=96%
```

### 5. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è (05_segmentation/)

**K-means –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è** –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–ª–æ–∫–æ–≤.

**–§–∞–π–ª—ã:**
- `clusters_description.csv` - —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤

**–ü—Ä–∏–º–µ—Ä:**
```
–ö–ª–∞—Å—Ç–µ—Ä 0: "–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç—ã" - —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
–ö–ª–∞—Å—Ç–µ—Ä 1: "–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" - –∏—Å–ø–æ–ª—å–∑—É—é—Ç 10+ –±–ª–æ–∫–æ–≤
–ö–ª–∞—Å—Ç–µ—Ä 2: "–ó–∞—è–≤–æ—á–Ω–∏–∫–∏" - —Ñ–æ–∫—É—Å –Ω–∞ –∑–∞—è–≤–∫–∞—Ö
–ö–ª–∞—Å—Ç–µ—Ä 3: "–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ" - –æ–±—ä—è–≤–ª–µ–Ω–∏—è + —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
–ö–ª–∞—Å—Ç–µ—Ä 4: "–°–º–µ—à–∞–Ω–Ω—ã–µ" - —Å—Ä–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
```

### 6. –ü–∞—Ç—Ç–µ—Ä–Ω—ã (06_patterns/)

**–§–∞–π–ª—ã:**
- `frequent_patterns.txt` - —á–∞—Å—Ç—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏–π

**–ü—Ä–∏–º–µ—Ä—ã:**
```
Lost - –¢–æ–ø –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –±–ª–æ–∫–æ–≤:
1. nav_count: 85,234 —Å–µ—Å—Å–∏–π
2. notif_count: 67,891 —Å–µ—Å—Å–∏–π
3. req_manage_count: 45,123 —Å–µ—Å—Å–∏–π

Stay - –¢–æ–ø –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –±–ª–æ–∫–æ–≤:
1. req_manage_count: 98,765 —Å–µ—Å—Å–∏–π  ‚Üê –≤–æ–∑–≤—Ä–∞—Ç –∫ –∑–∞—è–≤–∫–∞–º
2. nav_count: 87,654 —Å–µ—Å—Å–∏–π
3. my_home_count: 54,321 —Å–µ—Å—Å–∏–π
```

### 7. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (07_visualizations/)

**–ì—Ä–∞—Ñ–∏–∫–∏:**
- `session_duration_distribution.png` - –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `block_usage_heatmap.png` - —Ç–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–ª–æ–∫–æ–≤

### 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç (08_final_reports/)

**–§–∞–π–ª:** `MASTER_REPORT.md`

–°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç —Å–æ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –≤—ã–≤–æ–¥–∞–º–∏.

---

## üìà –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### –ú–µ—Ç—Ä–∏–∫–∏ —Å–µ—Å—Å–∏–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `sess_dur_sec` | –ü–æ–ª–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏ (—Å–µ–∫) |
| `global_session_id` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–µ—Å—Å–∏–∏ |

### –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –±–ª–æ–∫—É (√ó17)

| –ú–µ—Ç—Ä–∏–∫–∞ | –§–æ—Ä–º—É–ª–∞ | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |
|---------|---------|---------------|
| `count` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π | –ß–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
| `max_step` | max(step) | –ì–ª—É–±–∏–Ω–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è |
| `success_count` | Œ£ —É—Å–ø–µ—à–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π | –ö–æ–Ω–≤–µ—Ä—Å–∏—è |
| `review_count` | Œ£ review –¥–µ–π—Å—Ç–≤–∏–π | –û–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏–µ |
| `dur_sec` | Œ£ duration_seconds | –í—Ä–µ–º—è –≤ –±–ª–æ–∫–µ |
| `click_count` | Œ£ click_count | –£—Å–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `dbl_dur_sec` | Œ£ –¥—É–±–ª–µ–π duration | –ü–æ—Ç–µ—Ä—è–Ω–Ω–æ–µ –≤—Ä–µ–º—è |
| `dbl_count` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—É–±–ª–µ–π | –ü–æ–≤—Ç–æ—Ä—ã/—Ñ—Ä—É—Å—Ç—Ä–∞—Ü–∏—è |

### –í—ã—á–∏—Å–ª—è–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

**–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –±–ª–æ–∫–∞:**
```python
efficiency = 1 - (dbl_dur_sec / dur_sec)
```

**–ö–æ–Ω–≤–µ—Ä—Å–∏—è:**
```python
conversion = success_count / count
```

**–°—Ä–µ–¥–Ω—è—è –≥–ª—É–±–∏–Ω–∞:**
```python
avg_depth = max_step.mean()  # —Å—Ä–µ–¥–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–≤—à–∏—Ö
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–ª–æ–∫–∞

```python
# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
preprocessor = DataPreprocessor("config.yaml")
df = preprocessor.load_merged_data()

# –ê–Ω–∞–ª–∏–∑ –±–ª–æ–∫–∞ "–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏"
lost = df[df['is_lost'] == True]
stay = df[df['is_stay'] == True]

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
print("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞:")
print(f"Lost: {(lost['request_count'] > 0).mean()*100:.1f}%")
print(f"Stay: {(stay['request_count'] > 0).mean()*100:.1f}%")

print("\n–°—Ä–µ–¥–Ω—è—è –≥–ª—É–±–∏–Ω–∞ (—Å—Ä–µ–¥–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–≤—à–∏—Ö):")
print(f"Lost: {lost[lost['request_count']>0]['request_max_step'].mean():.2f}")
print(f"Stay: {stay[stay['request_count']>0]['request_max_step'].mean():.2f}")
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ custom –≤–æ—Ä–æ–Ω–∫–∏

```python
# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ —Ç–µ, –∫—Ç–æ –Ω–∞—á–∞–ª —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
df_started = df[df['request_count'] > 0]

# –ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ —É—Å–ø–µ—Ö
df_started['request_success'] = df_started['request_success_count'] > 0

# –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
conversion_lost = df_started[df_started['is_lost']]['request_success'].mean()
conversion_stay = df_started[df_started['is_stay']]['request_success'].mean()

print(f"–ö–æ–Ω–≤–µ—Ä—Å–∏—è Lost: {conversion_lost*100:.1f}%")
print(f"–ö–æ–Ω–≤–µ—Ä—Å–∏—è Stay: {conversion_stay*100:.1f}%")
```

### –ü—Ä–∏–º–µ—Ä 3: –í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑

```python
import pandas as pd

# –î–æ–±–∞–≤–ª—è–µ–º —á–∞—Å
df['hour'] = pd.to_datetime(df['–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è']).dt.hour

# –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º
hourly_lost = df[df['is_lost']].groupby('hour').size()
hourly_stay = df[df['is_stay']].groupby('hour').size()

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
import matplotlib.pyplot as plt

plt.figure(figsize=(12, 6))
plt.plot(hourly_lost.index, hourly_lost.values, label='Lost', marker='o')
plt.plot(hourly_stay.index, hourly_stay.values, label='Stay', marker='s')
plt.xlabel('–ß–∞—Å')
plt.ylabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π')
plt.title('–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º')
plt.legend()
plt.grid(True)
plt.show()
```

### –ü—Ä–∏–º–µ—Ä 4: ML –º–æ–¥–µ–ª—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –æ—Ç—Ç–æ–∫–∞

```python
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
features = [col for col in df.columns if any(
    col.startswith(prefix) for prefix in [
        'request_', 'req_manage_', 'profile_', 'nav_', 'notif_'
    ]
)] + ['sess_dur_sec']

X = df[features].fillna(0)
y = df['is_lost']

# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# –û–±—É—á–µ–Ω–∏–µ
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

# –û—Ü–µ–Ω–∫–∞
from sklearn.metrics import classification_report
y_pred = model.predict(X_test)
print(classification_report(y_test, y_pred))

# Feature importance
importances = pd.DataFrame({
    'feature': features,
    'importance': model.feature_importances_
}).sort_values('importance', ascending=False)

print("\n–¢–æ–ø-10 –≤–∞–∂–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:")
print(importances.head(10))
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `src/fb2/funnels/README.md` - –¥–µ—Ç–∞–ª–∏ –ø–æ funnel features
- `src/fb2/path_analyze/README_path_analyzer.md` - –∞–Ω–∞–ª–∏–∑ –ø—É—Ç–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `src/fb2/full_analyze/ANALYSIS_SYSTEM_SUMMARY.md` - —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞
- `src/fb2/README_categorization.md` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π

---

## üîç Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Out of Memory

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–∞–Ω–∫–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
extractor.transform(df, chunksize=100000)
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–ª–æ–Ω–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å pipeline:
1. `add_global_session_id()`
2. `calculate_event_duration()`
3. `remove_consecutive_duplicates_with_clicks()`
4. –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º `transform()`

### –ü—Ä–æ–±–ª–µ–º–∞: –î–æ–ª–≥–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –§–∏–ª—å—Ç—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
df = df[df['date'] >= '2025-09-01']
```

---

## üë• –ê–≤—Ç–æ—Ä—ã

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ú–ö–î.
–ö–æ—Ç–µ–ª—å–Ω–∏–∫–æ–≤ –ê–Ω–¥—Ä–µ–π

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
