# Документация: Обновленная категоризация с типами действий

## Изменения в версии 2

### Новые возможности

1. **Типизация действий** - каждое действие классифицируется по типу:
   - `regular`: обычные действия (выводятся без отступа)
   - `cancel_actions`: действия отмены/возврата назад
   - `exit_actions`: выход из процесса, отмена операций
   - `success_review`: просмотр, ознакомление, переходы к информации
   - `success_actions`: целевые успешные действия

2. **Автоматическое объединение похожих действий** - действия с похожим написанием объединяются:
   - "выбор тега 1" + "Выбор тега 1" = "Выбор тега 1" (67,439)
   - "Выбор услуги партнёров" + "Выбор услуги партнеров" = "Выбор услуги партнёров" (452)

3. **Правильное распределение по блокам**:
   - "Переход в раздел 'Заявки'" перемещен в блок "Просмотр и управление заявками"
   - "Переход в раздел 'Настройки уведомлений'" перемещен в блок "Профиль"
   - Улучшена логика для гостевого доступа и создания адреса

## Структура выходных файлов

### categorized_combinations_v2.json

```json
{
  "metadata": {
    "generated_at": "...",
    "total_records": 1822985,
    "total_unique_combinations": 501,
    "final_combinations_count": 498,
    "blocks_count": 17
  },
  "blocks": [
    {
      "name": "Название блока",
      "total_count": 595534,
      "combinations_count": 331,
      "groups": [
        {
          "screen": "Экран",
          "functional": "Функционал",
          "total_count": 178630,
          "regular_actions": [...],
          "cancel_actions": [...],
          "exit_actions": [...],
          "success_review": [...],
          "success_actions": [...]
        }
      ]
    }
  ]
}
```

### categorized_combinations_v2.txt

```
Создание заявки (595,534):
    Новая заявка => Открытие экрана => Не указано (178,630)
    Новая заявка => Выбор через теги => Выбор тега 1 (67,439)
    ...
    cancel_actions:
        Новая заявка => Возврат на предыдущий этап => Тап на стрелку назад (102,203)
    success_actions:
        Новая заявка => Отправка заявки => Тап на кнопку 'Создать заявку' (45,221)
```

## Логика определения типов действий

### cancel_actions
- Возврат на предыдущий этап
- Тап на стрелку назад

### exit_actions
- Отмена создания
- Отмена выбора
- Отмена подачи заявки
- Отмена отзыва доступа
- Отмена изменения
- Отмена удаления

### success_review
- Раскрытие вкладок
- Открытие разделов
- Переход в справку
- Переход к информации
- Ознакомление с документами
- Переход к предварительному просмотру
- Переход к списку черновиков

### success_actions
- Отправка заявки
- Публикация объявления
- Подтверждение/Опровержение
- Активация/Применение
- Просмотр уведомления
- Звонки, открытие дверей
- Удаление, редактирование
- Прочтение инструкций
- Загрузка файлов

## Статистика

### Общая
- **Исходных комбинаций**: 501
- **Финальных комбинаций**: 498
- **Объединено**: 3 комбинации

### По блокам (топ-5)

1. **Создание заявки**: 331 комбинаций, 595,534 событий
2. **Просмотр и управление заявками**: 7 комбинаций, 409,641 событий
3. **Профиль**: 5 комбинаций, 151,034 событий
4. **Навигация**: 2 комбинации, 147,148 событий
5. **Уведомления**: 1 комбинация, 144,329 событий

## Использование

### Запуск категоризации

```bash
python3 categorize_combinations_v2.py
```

**Входной файл**: `/mnt/user-data/uploads/unique_combinations.json`
**Выходной файл**: `categorized_combinations_v2.json`

### Экспорт в текст

```bash
python3 export_to_text_v2.py
```

**Входной файл**: `categorized_combinations_v2.json`
**Выходной файл**: `categorized_combinations_v2.txt`

## Преимущества версии 2

1. **Более детальный анализ воронок**: типизация действий позволяет точно определять:
   - Точки отмены (cancel_actions)
   - Точки выхода (exit_actions)
   - Этапы ознакомления (success_review)
   - Целевые конверсии (success_actions)

2. **Чистые данные**: автоматическое объединение похожих действий устраняет дубликаты

3. **Правильная группировка**: улучшенная логика распределения по блокам

## Примеры анализа

### Пример 1: Анализ успешности создания заявки

```
Создание заявки (595,534 событий):
  Начало: Открытие экрана (178,630)
  
  Отток на отмену: 102,203 (-57%)
  cancel_actions:
    - Возврат на предыдущий этап (102,203)
  
  Успешное завершение: 45,221 (25% от начала)
  success_actions:
    - Отправка заявки (45,221)
```

### Пример 2: Анализ воронки ОСС

```
Опросы и собрания собственников:
  Точки выхода:
    - Отмена создания: 328
    - Возврат назад: 829
  
  Этапы ознакомления (9 действий):
    - Согласие с процессом: 913
    - Предварительный просмотр: 194
    - Ознакомление с обязанностями: 174
    ...
  
  Целевые действия (14 действий):
    - Отправка на проверку: 20
    - Добавление вопроса: 24
    ...
```

## Отличия от версии 1

| Параметр | Версия 1 | Версия 2 |
|----------|----------|----------|
| Типизация действий | Нет | Да (4 типа) |
| Объединение похожих | Нет | Да |
| Комбинаций | 501 | 498 |
| Формат вывода | Плоский | Иерархический |
| Группировка типов | Нет | Да |

## Файлы проекта

- `categorize_combinations_v2.py` - скрипт категоризации v2
- `export_to_text_v2.py` - скрипт экспорта v2
- `categorized_combinations_v2.json` - JSON с типизацией
- `categorized_combinations_v2.txt` - текстовый файл
- `README_v2.md` - этот файл

---
**Версия**: 2.0
**Дата**: 2025-12-23
**Автор**: Claude (Anthropic)
